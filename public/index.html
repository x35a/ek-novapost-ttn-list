<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTN List</title>
</head>
<body>
    <div id="loader">LOADING DATA.</div>
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');
        const loader = document.getElementById('loader');
        let eventSource;
        let loadingInterval;

        // Simple loading animation
        function startLoading() {
            const loadingText = 'LOADING DATA ';
            let dots = 0;
            loader.textContent = loadingText;
            loadingInterval = setInterval(() => {
                dots = dots >= 3 ? 0 : dots + 1;
                loader.textContent = loadingText + '.'.repeat(dots);
            }, 500);
        }

        function stopLoading() {
            clearInterval(loadingInterval);
            loader.style.display = 'none';
        }

        function connectSSE() {
            eventSource = new EventSource('/events');
            startLoading();

            eventSource.onmessage = function(event) {
                output.innerHTML += event.data;
            };

            // Handle error events
            eventSource.addEventListener('error', function(event) {
                output.innerHTML = `<div style="color: red">${event.data}</div>`;
                eventSource.close();
                stopLoading();
            });

            // Listen for the complete event
            eventSource.addEventListener('complete', function(event) {
                console.log('Data transfer complete, closing connection');
                eventSource.close();
                stopLoading();
            });

            eventSource.onerror = function(error) {
                if (eventSource.readyState === EventSource.CLOSED) {
                    console.log('Connection closed by server');
                    stopLoading();
                }
            };
        }

        connectSSE();
    </script>
</body>
</html> 